<a name="rjbuP"></a>
## 1.思政说明
杭电赏花网旨在展示杭电校园内丰富美丽的花卉景观，提供杭电校园的赏花信息，同学们可以在网站上查看杭电下沙校内各个区域的各种花的介绍和观赏路线。也可通过本地新增赏花信息丰富完善杭电赏花网的内容。在更多链接页收集各种关于花卉的链接，方便同学们了解更多关于花卉的知识。本网站可以丰富和调剂同学们的文化生活，增添乐趣，陶冶性情，审美爱美，还能增加科学知识，提高文化艺术素养。
<a name="ZoHDP"></a>
## 2.网站介绍
杭电赏花网是一个支持本地持久化存储的单页面应用，网站包括首页、赏花列表页、赏花详细页、新增花信息的表单页，更多链接页。
<a name="XYrbA"></a>
### 2.1 页面公共头部
在各个页面的共同头部显示网站的名称，以及校园的实时天气情况，方便同学们能够根据天气情况去校园实地观赏！<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/22336651/1704006702048-38f150c5-294e-415c-86d9-d3c17e9d1fd6.png#averageHue=%23d9dee7&clientId=u57d555cd-7d86-4&from=paste&height=32&id=u8dd3f5e3&originHeight=64&originWidth=1360&originalType=binary&ratio=2&rotation=0&showTitle=false&size=38302&status=done&style=none&taskId=u1eb5fbe8-42cd-4c25-b21d-db1fdd5935b&title=&width=680)
<a name="iQnM4"></a>
### 2.2 首页
通过轮播图展示校园内的花卉图片，以及展示杭电赏花信息和更多链接的内容聚合。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/22336651/1704005942190-55d0ec95-e970-475b-953e-a07a05eca251.png#averageHue=%23d7ab4e&clientId=u57d555cd-7d86-4&from=paste&height=944&id=u8db70bab&originHeight=1888&originWidth=2910&originalType=binary&ratio=2&rotation=0&showTitle=false&size=3496837&status=done&style=none&taskId=u0f39dd36-4c33-4d17-960d-a6ea893ba2d&title=&width=1455)
<a name="B5Pj2"></a>
### 2.3赏花信息（列表页）
动态展示赏花信息列表，可以点击进入详细页<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/22336651/1704006027274-4fc325be-1fa0-40c3-ab18-ca9bd54e43f1.png#averageHue=%23988643&clientId=u57d555cd-7d86-4&from=paste&height=944&id=u7061955c&originHeight=1888&originWidth=2910&originalType=binary&ratio=2&rotation=0&showTitle=false&size=604809&status=done&style=none&taskId=u98e18b9b-aa28-4bad-9f6e-de369bc9945&title=&width=1455)
<a name="H9IdC"></a>
### 2.4详情页
动态展示了每种花的详细信息和高清图片。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/22336651/1704006053467-33976ddc-9613-4810-b61a-3222757f177a.png#averageHue=%23e7e7e5&clientId=u57d555cd-7d86-4&from=paste&height=944&id=uedfa04f3&originHeight=1888&originWidth=2910&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1892340&status=done&style=none&taskId=ue7c155e7-921a-43d2-9a2b-58dc26545a9&title=&width=1455)<br />新增赏花信息（表单页）：可以新增赏花信息，添加后会将数据存储在本地，然后在列表页，详情页动态更新。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/22336651/1704006074729-2bd086cf-5625-455e-97a1-85f0e06d2d03.png#averageHue=%23f2f2f2&clientId=u57d555cd-7d86-4&from=paste&height=944&id=ud43c1aec&originHeight=1888&originWidth=2910&originalType=binary&ratio=2&rotation=0&showTitle=false&size=299543&status=done&style=none&taskId=u1379045c-d5d0-4960-bb30-40d3ecc7cd8&title=&width=1455)
<a name="UFhKE"></a>
### 2.5更多链接页
收集各种关于花卉的链接，方便同学们了解更多关于花卉的知识。<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/22336651/1704006090744-80545efd-e2a9-441e-8014-81d61b032bc6.png#averageHue=%23efaf3d&clientId=u57d555cd-7d86-4&from=paste&height=944&id=u49a8b096&originHeight=1888&originWidth=2910&originalType=binary&ratio=2&rotation=0&showTitle=false&size=433783&status=done&style=none&taskId=u9456351e-618f-434f-b078-c6a00d19b02&title=&width=1455)
<a name="sttZv"></a>
### 其他

- 在每个页面右下角中都有一个返回顶部的按钮，方便用户在浏览信息滚动过长时候，可以一键点击按钮返回到页面顶部

![image.png](https://cdn.nlark.com/yuque/0/2023/png/22336651/1704006537220-b8a60d20-cd3b-4a98-8cac-a6f8e6c30628.png#averageHue=%23efefef&clientId=u57d555cd-7d86-4&from=paste&height=118&id=ub5e99438&originHeight=236&originWidth=338&originalType=binary&ratio=2&rotation=0&showTitle=false&size=5044&status=done&style=none&taskId=u9fc6c5ed-d024-45a0-9d75-366e45e92c9&title=&width=169)

- 滚动时候固定头部

![image.png](https://cdn.nlark.com/yuque/0/2023/png/22336651/1704012293952-80cbee21-f063-4c54-8c52-3377b81236cd.png#averageHue=%239a9994&clientId=u57d555cd-7d86-4&from=paste&height=296&id=u39c5ff77&originHeight=592&originWidth=2912&originalType=binary&ratio=2&rotation=0&showTitle=false&size=514830&status=done&style=none&taskId=u796efea3-22a8-4c21-bfde-b05c451b5a6&title=&width=1456)
<a name="i0Zhq"></a>
## 3.技术总结
<a name="cAeLL"></a>
### 3.1 单页应用技术设计

- 整体设计：

定义路由配置->监听哈希变化->处理路由搜索匹配->调用对应渲染组件函数渲染
> router.js

![image.png](https://cdn.nlark.com/yuque/0/2023/png/22336651/1704007713249-04f6c605-ecd2-4d2f-9e6c-02dc220deb9a.png#averageHue=%2320242c&clientId=u57d555cd-7d86-4&from=paste&height=814&id=wfwsb&originHeight=1628&originWidth=1654&originalType=binary&ratio=2&rotation=0&showTitle=false&size=301172&status=done&style=none&taskId=u1e30603d-6604-4f9e-aaa7-c4453af45d4&title=&width=827)

- 详细设计
1. 定义配置不同的路由对应不同的组件渲染函数

![image.png](https://cdn.nlark.com/yuque/0/2023/png/22336651/1704007970208-3311baec-fefc-4878-9dd9-527422c81201.png#averageHue=%2320262e&clientId=u57d555cd-7d86-4&from=paste&height=217&id=uc1344996&originHeight=434&originWidth=1184&originalType=binary&ratio=2&rotation=0&showTitle=false&size=98040&status=done&style=none&taskId=u848fa908-a335-485e-9b50-e90c1f935e5&title=&width=592)

2. 添加hashchange事件监听器，当hashchange 时候，调用handleRouteChange 回调函数，在这个函数中获取**#**后面的路径与自己定义的路由路径进行搜索匹配

![image.png](https://cdn.nlark.com/yuque/0/2023/png/22336651/1704008092416-235763d7-62ec-4d03-8ebf-b11426049487.png#averageHue=%2321242c&clientId=u57d555cd-7d86-4&from=paste&height=632&id=ud1fab44a&originHeight=1264&originWidth=1666&originalType=binary&ratio=2&rotation=0&showTitle=false&size=284022&status=done&style=none&taskId=uc136de8c-3d0d-4fbc-b986-bff11b74a21&title=&width=833)

3. 根据搜索匹配结果调用路由组件渲染函数renderRouteComponent，根据结果去调用对应的组件渲染

![image.png](https://cdn.nlark.com/yuque/0/2023/png/22336651/1704008559440-90326ef8-14b0-4d63-b99a-90269e8b25e8.png#averageHue=%2322242d&clientId=u57d555cd-7d86-4&from=paste&height=799&id=ufe005ee3&originHeight=1598&originWidth=1454&originalType=binary&ratio=2&rotation=0&showTitle=false&size=291158&status=done&style=none&taskId=u3993058b-e927-411b-b805-bd0f87d6659&title=&width=727)
<a name="OMxyc"></a>
### 3.2 数据 Json+页面模板化
把网站内容信息以 json 格式表示+模版字符串->拼接成 html->插入到网页结构中<br />例子(列表页动态渲染)：<br />json 数据<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/22336651/1704008986465-960286bb-db8a-473f-81ed-7d7eaf811e0b.png#averageHue=%231e2127&clientId=u57d555cd-7d86-4&from=paste&height=440&id=u9f023ff7&originHeight=880&originWidth=1988&originalType=binary&ratio=2&rotation=0&showTitle=false&size=205334&status=done&style=none&taskId=u580f2978-959b-484c-921b-7bbe2bb0838&title=&width=994)<br />模版字符串（优势：浏览器原生支持）拼接
> render.js

![image.png](https://cdn.nlark.com/yuque/0/2023/png/22336651/1704009055053-0e172417-5cdd-4f12-bf75-749af05bb45b.png#averageHue=%2324232f&clientId=u57d555cd-7d86-4&from=paste&height=578&id=ua93c6cb3&originHeight=1156&originWidth=1892&originalType=binary&ratio=2&rotation=0&showTitle=false&size=209244&status=done&style=none&taskId=u19f5e1d8-21ec-4b93-bf43-1fbfad2e57a&title=&width=946)
<a name="aQfr2"></a>
### 3.2 本地存储持久化+图片压缩存储
整体设计：<br />localforage 库+uuid（）+表单数据

- 引用 localforage 库：
   - 优点：相比 localstorage 异步读取，容量限制变大，自动降级兼容处理
   - 缺点：引入第三方库，体积变大，首次加载变慢
- uuid 库保证数据的唯一性
- 表单数据中的图片采用 canvas 绘制后压缩为 base64 文本形式存储
   - 优点：图片数据存储体积大大变小
   - 缺点：图片画质下降

例子：
> form.js

1. 使用 FileReader 读取文件后转化为 base64 交给 canvas 绘制

![image.png](https://cdn.nlark.com/yuque/0/2023/png/22336651/1704009920799-d074b987-8d4a-4715-be9f-c1fa11f62862.png#averageHue=%23272633&clientId=u57d555cd-7d86-4&from=paste&height=451&id=u204288e0&originHeight=902&originWidth=1338&originalType=binary&ratio=2&rotation=0&showTitle=false&size=163280&status=done&style=none&taskId=u5f9513d8-74fa-412d-adc8-92b880729c8&title=&width=669)

2. canvas 绘制图片后，再通过canvas.toDataURL 函数将质量压缩后的图片转化为 base64

![image.png](https://cdn.nlark.com/yuque/0/2023/png/22336651/1704010095164-19712401-eb4c-46f2-88ef-b75ab7826276.png#averageHue=%23252430&clientId=u57d555cd-7d86-4&from=paste&height=828&id=u6876aed6&originHeight=1656&originWidth=1668&originalType=binary&ratio=2&rotation=0&showTitle=false&size=369167&status=done&style=none&taskId=u10124a12-80aa-425b-8de2-ff5f32fe5a2&title=&width=834)

3. 根据 uuid 生产唯一的 id，并通过 new Date()获取时间，汇集字段拼接成一个 object

![image.png](https://cdn.nlark.com/yuque/0/2023/png/22336651/1704010258597-a1c92e5e-3cc5-4600-b1ed-d6c5b45505af.png#averageHue=%23262431&clientId=u57d555cd-7d86-4&from=paste&height=533&id=u6988143e&originHeight=1066&originWidth=1568&originalType=binary&ratio=2&rotation=0&showTitle=false&size=279214&status=done&style=none&taskId=ue03d00a0-e8e1-44ab-9dc5-050ee1c08ff&title=&width=784)

4. 调用 localforage 存储 键为 uuid 生成的 id，值为表单的数据（这个库会自动将 object 转化为 JSON 存储）

![image.png](https://cdn.nlark.com/yuque/0/2023/png/22336651/1704010397463-987b47d3-99f6-417b-93d3-cc33d4e6d0bb.png#averageHue=%231f232a&clientId=u57d555cd-7d86-4&from=paste&height=316&id=u9073621e&originHeight=632&originWidth=1022&originalType=binary&ratio=2&rotation=0&showTitle=false&size=102337&status=done&style=none&taskId=u8030a373-1c0a-4410-9975-ad3812173bf&title=&width=511)

5. 在列表和详情页会迭代读取 localforage 中的数据动态生成页面
> render.js

![image.png](https://cdn.nlark.com/yuque/0/2023/png/22336651/1704010508454-e2f15cd4-e96c-4d5f-a5d8-9d5bcffaf7a7.png#averageHue=%231e2229&clientId=u57d555cd-7d86-4&from=paste&height=358&id=uba563a3d&originHeight=716&originWidth=1234&originalType=binary&ratio=2&rotation=0&showTitle=false&size=111503&status=done&style=none&taskId=u1faaa097-abd7-4bc1-a796-8812fbe21f4&title=&width=617)
<a name="vU84s"></a>
### 3.3 其他

1. 调用高德地图 sdk 获取校园天气（因本项目无代理服务器，故使用源码硬编码接口密钥，实际上线不推荐）

![image.png](https://cdn.nlark.com/yuque/0/2023/png/22336651/1704010697394-41837aa5-68a4-4902-beff-3a91622154a8.png#averageHue=%231e2128&clientId=u57d555cd-7d86-4&from=paste&height=179&id=u3e0f64b6&originHeight=358&originWidth=1934&originalType=binary&ratio=2&rotation=0&showTitle=false&size=92984&status=done&style=none&taskId=u5a6ae6be-dac1-4445-99c5-2f4e554fdaa&title=&width=967)
> init.js

![image.png](https://cdn.nlark.com/yuque/0/2023/png/22336651/1704010701429-9ed92150-5e7f-4b28-84b0-081be0aa267a.png#averageHue=%231e2228&clientId=u57d555cd-7d86-4&from=paste&height=448&id=ExQst&originHeight=896&originWidth=1868&originalType=binary&ratio=2&rotation=0&showTitle=false&size=242766&status=done&style=none&taskId=ue57a07aa-3600-4b59-a4ae-209c333b326&title=&width=934)

2. 引入第三方字体和一个 jquery 轮播图插件，第三方字体设置在网站名称上凸显网站的名称，引入轮播图为了动态展示不同的花图片吸引用户。

轮播图插件：<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/22336651/1704010992784-85f852a3-4fa8-40d2-88b4-3e73759b6237.png#averageHue=%231e2229&clientId=u57d555cd-7d86-4&from=paste&height=159&id=ub029ba46&originHeight=318&originWidth=1008&originalType=binary&ratio=2&rotation=0&showTitle=false&size=42756&status=done&style=none&taskId=ufa76e784-5f5d-4a6f-bb56-47a9a9bb1f0&title=&width=504)<br />第三方字体：
> normalize.css

![image.png](https://cdn.nlark.com/yuque/0/2023/png/22336651/1704011040064-e8c80185-15c6-4170-b2f0-2b312cd9758a.png#averageHue=%231e2228&clientId=u57d555cd-7d86-4&from=paste&height=147&id=u38bd84d9&originHeight=294&originWidth=1912&originalType=binary&ratio=2&rotation=0&showTitle=false&size=87918&status=done&style=none&taskId=ue1f8443f-ef3f-4a97-8078-5f19449f4b6&title=&width=956)<br />![image.png](https://cdn.nlark.com/yuque/0/2023/png/22336651/1704011125028-045a78a3-de8e-470b-a2fa-d59e049f13ba.png#averageHue=%23202329&clientId=u57d555cd-7d86-4&from=paste&height=60&id=ue77eb74a&originHeight=120&originWidth=1014&originalType=binary&ratio=2&rotation=0&showTitle=false&size=22088&status=done&style=none&taskId=ua966f3f7-c419-4822-b863-990249621ce&title=&width=507)

2. 返回顶部按钮，监听页面滚动，滚动超出一页距离后才显示返回顶部按钮，点击返回按钮通过window.scrollTo 设置 top 为 0 返回到顶部
> init.js

![image.png](https://cdn.nlark.com/yuque/0/2023/png/22336651/1704011242506-648155ed-d50b-47ab-b1a4-98fbc142cff1.png#averageHue=%231f2229&clientId=u57d555cd-7d86-4&from=paste&height=438&id=u1547e3eb&originHeight=876&originWidth=1758&originalType=binary&ratio=2&rotation=0&showTitle=false&size=183010&status=done&style=none&taskId=u7efa9565-05c5-4df8-8c28-a2811e087a4&title=&width=879)

3. 滚动时，固定头部导航，fix 为固定头部的容器设置固定定位但是会脱离文档流，所以设置一个空的 div 高度与 fix 容器高度一致，代替原来的位置。意义：让用户在滚动时想点击顶部导航到其他页面时候不用返回到顶部再点击，用户使用友好

![image.png](https://cdn.nlark.com/yuque/0/2023/png/22336651/1704011940155-f894b115-5c03-4dca-87b4-3c878aeba380.png#averageHue=%2320232a&clientId=u57d555cd-7d86-4&from=paste&height=101&id=uf7cbe186&originHeight=202&originWidth=1124&originalType=binary&ratio=2&rotation=0&showTitle=false&size=33858&status=done&style=none&taskId=u37f2cefe-080a-4393-b227-93672d64f4e&title=&width=562)
> normalize.css

![image.png](https://cdn.nlark.com/yuque/0/2023/png/22336651/1704011963420-e8373240-dea6-40dd-93dc-9132f42d1cb4.png#averageHue=%2321242a&clientId=u57d555cd-7d86-4&from=paste&height=262&id=u9589e19b&originHeight=524&originWidth=602&originalType=binary&ratio=2&rotation=0&showTitle=false&size=50767&status=done&style=none&taskId=u8d97ee3c-aaaf-44ee-89e2-03c923f23b1&title=&width=301)
<a name="MA3Z8"></a>
## 4. 课程心得与建议
个人心得：<br />通过本课程的学习，加深了对 web 的理解，以及网站结构的理解，学习到了技术应该为内容服务的思想，技术的出现一定是为了解决某一特定问题。<br />建议：<br />暂时没有建议，老师讲授的知识正是我们所缺乏的基础知识和专业素养。
